set.seed(123)

data <- data.frame(
  customer_id = 1:200,
  age = sample(20:65, 200, replace = TRUE),
  gender = sample(c("M", "F"), 200, replace = TRUE),
  region = sample(c("Seoul", "Busan", "Incheon", "Daegu"), 200, replace = TRUE),
  membership = sample(c("Bronze", "Silver", "Gold"), 200, replace = TRUE, prob = c(0.3, 0.4, 0.3)),
  visit_count = rpois(200, lambda = 4),
  total_spent = round(rnorm(200, mean = 300, sd = 100), 1),
  last_visit = sample(seq(as.Date('2023-01-01'), as.Date('2023-12-31'), by="day"), 200, replace = TRUE)
)

data$total_spent[data$total_spent < 0] <- 0 # ì´ìƒì¹˜ ì²˜ë¦¬
head(data)


#Q.ê³ ê°ì˜ ì—°ë ¹, ì„±ë³„, ì§€ì—­, ë©¤ë²„ì‹­ ë“±ê¸‰, ë°©ë¬¸ íšŸìˆ˜, ë§ˆì§€ë§‰ ë°©ë¬¸ì¼ ë“±ì˜ ìš”ì¸ì´ ì´ ì§€ì¶œ(total_spent)ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ëŠ”ì§€, ì‹œê°í™”ì™€ í†µê³„ ìš”ì•½ì„ í†µí•´ ì£¼ìš” ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ì‹œì˜¤
# 0. í•„ìˆ˜ íŒ¨í‚¤ì§€ ë¡œë”©
library(ggplot2)
library(dplyr)
library(car)

# 1. ë‚ ì§œ ì²˜ë¦¬
data$days_since_last_visit <- as.numeric(Sys.Date() - data$last_visit)

# 2. íšŒê·€ ëª¨ë¸
lm_model <- lm(total_spent ~ age + gender + region + membership + visit_count + days_since_last_visit, data = data)

cat("ğŸ” íšŒê·€ ê²°ê³¼ ìš”ì•½:\n")
print(summary(lm_model))

# 3. ë‹¤ì¤‘ê³µì„ ì„± ê²€ì‚¬
cat("\nğŸ“ ë‹¤ì¤‘ê³µì„ ì„± (VIF) ê²€ì‚¬:\n")
print(vif(lm_model))

# 4. ì‹œê°í™” 1: ë°©ë¬¸ íšŸìˆ˜ vs ì§€ì¶œ
ggplot(data, aes(x = visit_count, y = total_spent, color = membership)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "ë°©ë¬¸ íšŸìˆ˜ vs ì´ ì§€ì¶œ (ë©¤ë²„ì‹­ë³„)", x = "ë°©ë¬¸ íšŸìˆ˜", y = "ì´ ì§€ì¶œ")

# 5. ì‹œê°í™” 2: ì—°ë ¹ vs ì§€ì¶œ
ggplot(data, aes(x = age, y = total_spent)) +
  geom_point(alpha = 0.5, color = "darkgreen") +
  geom_smooth(method = "lm", color = "black", se = FALSE) +
  theme_minimal() +
  labs(title = "ì—°ë ¹ê³¼ ì´ ì§€ì¶œì˜ ê´€ê³„", x = "ë‚˜ì´", y = "ì´ ì§€ì¶œ")

# 6. ì‹œê°í™” 3: ì§€ì—­ë³„ ë°•ìŠ¤í”Œë¡¯
ggplot(data, aes(x = region, y = total_spent, fill = region)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "ì§€ì—­ë³„ ì´ ì§€ì¶œ ë¶„í¬", x = "ì§€ì—­", y = "ì´ ì§€ì¶œ")

# 7. ì‹œê°í™” 4: ë©¤ë²„ì‹­ ë“±ê¸‰ë³„ í‰ê·  ì§€ì¶œ
data %>%
  group_by(membership) %>%
  summarise(mean_spent = mean(total_spent)) %>%
  ggplot(aes(x = membership, y = mean_spent, fill = membership)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "ë©¤ë²„ì‹­ ë“±ê¸‰ë³„ í‰ê·  ì§€ì¶œ", x = "ë©¤ë²„ì‹­", y = "í‰ê·  ì§€ì¶œ")
